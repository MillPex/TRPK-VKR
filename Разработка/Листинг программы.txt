&НаКлиенте
Процедура СписокКомплектующихКомплектующееПриИзменении(Элемент)
    СП = Элементы.СписокКомплектующих.ТекущиеДанные;
    СП.Цена = ОбщНазнач.АвтоустановкаЦены(Объект.Дата, СП.Комплектующее);
КонецПроцедуры

Функция АвтоустановкаЦены(Дата, Комплектующее) Экспорт
    Отбор = Новый Структура;
    Отбор.Вставить(«Комплектующее», Комплектующее);
    Данные = РегистрыСведений.ЦеныКомплектующих.ПолучитьПоследнее(Дата, Отбор);
    Возврат Данные.Цена
КонецФункции


&НаКлиенте
Процедура СписокКомплектующихКоличествоПриИзменении(Элемент)
    СП = Элементы.СписокКомплектующих.ТекущиеДанные; 
    СП.Стоимость = СП.Количество * СП.Цена;
КонецПроцедуры


&НаСервере
Функция РассчитатьИтогСтоимость()
    
    Итог = 0;
    
    Для Каждого Строка Из Объект.СписокКомплектующих Цикл
        Если Строка.Количество > 0 И Строка.Цена > 0 Тогда
            Итог = Итог + (Строка.Количество * Строка.Цена);
            Строка.Стоимость = Строка.Количество * Строка.Цена;
        КонецЕсли;
    КонецЦикла;

    Объект.ИтогСтоимость = Итог;
    
    Возврат Итог;
    
КонецФункции


&НаКлиенте
Процедура СписокКомплектующихПриИзменении(Элемент)
    РассчитатьИтогСтоимость(); 
КонецПроцедуры

&НаСервере
Функция РассчитатьИтогСтоимость()
    
    Итог = 0;
    
    Для Каждого Строка Из Объект.СписокКомплектующих Цикл
        Если Строка.Количество > 0 И Строка.Цена > 0 Тогда
            Итог = Итог + (Строка.Количество * Строка.Цена);
            Строка.Стоимость = Строка.Количество * Строка.Цена;
        КонецЕсли;
    КонецЦикла;

    Объект.ИтогСтоимость = Итог;
    
    Возврат Итог;
    
КонецФункции


&НаКлиенте
Процедура СписокКомплектующихПриИзменении(Элемент)
    РассчитатьИтогСтоимость(); 
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды,ПараметрыВыполненияКоманды)
	
    ТабДок = Новый ТабличныйДокумент;
	
    ПечатьНаСервере(ТабДок, ПараметрКоманды);

    ТабДок.Показать("Выдача компьютера");
	
КонецПроцедуры


&НаСервере
Процедура ПечатьНаСервере(ТабДок, СсылкаНаДокумент)
		
    Документы.СборкиКомпьютеров.Печать(ТабДок, СсылкаНаДокумент);	
	
КонецПроцедуры


&НаСервере
Процедура ОбработкаПроведения(Отказ, Режим)
    Запись = РегистрыСведений.ЦеныКомплектующих.СоздатьЗапись();
    Запись.Комплектующее = ЭтотОбъект.Комплектующее;
    Запись.Цена = ЭтотОбъект.Цена;
    Запись.Период = ТекущаяДата();
    Запись.Записать();
КонецПроцедуры

ВЫБРАТЬ
    СборкиКомпьютеров.Дата КАК Дата,
    СборкиКомпьютеров.Сборщик КАК Сборщик,
    СборкиКомпьютеров.Заказчик КАК Заказчик,
	СборкиКомпьютеров.НомерЗаявкиВыдачи.СписокКомплектующих.(
             Комплектующее КАК Комплектующее,
             Количество КАК Количество
    ) КАК НомерЗаявкиВыдачи,
    СборкиКомпьютеров.НомерЗаявкиВыдачи.ИтогСтоимость КАК ИтогСтоимость,
    1 КАК Количество
ИЗ
    Документ.СборкиКомпьютеров КАК СборкиКомпьютеров
ГДЕ 
    СборкиКомпьютеров.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания